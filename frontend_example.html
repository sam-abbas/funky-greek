<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stock Chart Analyzer - Frontend Example</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f5f5;
    }

    .container {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    h1 {
      color: #2c3e50;
      text-align: center;
      margin-bottom: 30px;
    }

    .upload-section {
      border: 2px dashed #3498db;
      border-radius: 10px;
      padding: 40px;
      text-align: center;
      margin-bottom: 30px;
      background-color: #f8f9fa;
    }

    .upload-section:hover {
      border-color: #2980b9;
      background-color: #e3f2fd;
    }

    .file-input {
      display: none;
    }

    .upload-btn {
      background: #3498db;
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px;
    }

    .upload-btn:hover {
      background: #2980b9;
    }

    .demo-btn {
      background: #27ae60;
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px;
    }

    .demo-btn:hover {
      background: #229954;
    }

    .api-url-input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      margin-bottom: 20px;
      font-size: 14px;
    }

    .results {
      margin-top: 30px;
    }

    .result-card {
      background: #f8f9fa;
      border-left: 4px solid #3498db;
      padding: 20px;
      margin: 15px 0;
      border-radius: 5px;
    }

    .loading {
      text-align: center;
      color: #7f8c8d;
      font-style: italic;
    }

    .error {
      background: #f8d7da;
      border-left-color: #dc3545;
      color: #721c24;
    }

    .success {
      background: #d4edda;
      border-left-color: #28a745;
      color: #155724;
    }

    .indicator {
      display: inline-block;
      background: #e9ecef;
      padding: 5px 10px;
      border-radius: 15px;
      margin: 5px;
      font-size: 12px;
    }

    .signal-buy {
      background: #d4edda;
      color: #155724;
    }

    .signal-sell {
      background: #f8d7da;
      color: #721c24;
    }

    .signal-hold {
      background: #fff3cd;
      color: #856404;
    }

    .pattern {
      background: #e3f2fd;
      padding: 10px;
      margin: 10px 0;
      border-radius: 5px;
      border-left: 3px solid #2196f3;
    }

    .confidence-bar {
      background: #e9ecef;
      height: 20px;
      border-radius: 10px;
      overflow: hidden;
      margin: 5px 0;
    }

    .confidence-fill {
      background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1);
      height: 100%;
      transition: width 0.3s ease;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>üìä Stock Chart Analyzer</h1>

    <div class="upload-section">
      <h3>üîó API Configuration</h3>
      <input type="text" id="apiUrl" class="api-url-input"
        placeholder="Enter your deployed API URL (e.g., https://your-app.onrender.com)"
        value="https://funky-greek.onrender.com">
      <p><small>‚úÖ Connected to: <strong>https://funky-greek.onrender.com</strong></small></p>
    </div>

    <div class="upload-section">
      <h3>üìÅ Upload Chart Image</h3>
      <p>Select a stock chart image to analyze</p>
      <input type="file" id="fileInput" class="file-input" accept="image/*">
      <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
        Choose File
      </button>
      <button class="demo-btn" onclick="getDemoAnalysis()">
        üöÄ Try Demo Analysis
      </button>
    </div>

    <div id="results" class="results"></div>
  </div>

  <script>
    // Get API URL from input
    function getApiUrl() {
      return document.getElementById('apiUrl').value.trim();
    }

    // Display results
    function displayResults(data, isDemo = false) {
      const resultsDiv = document.getElementById('results');

      if (isDemo) {
        resultsDiv.innerHTML = '<h3>üéØ Demo Analysis Results</h3>';
      } else {
        resultsDiv.innerHTML = '<h3>üìä Analysis Results</h3>';
      }

      if (data.success && data.analysis) {
        const analysis = data.analysis;

        // Overall sentiment
        const sentimentCard = createResultCard(
          `Overall Sentiment: ${analysis.overall_sentiment.toUpperCase()}`,
          `Confidence: ${(analysis.confidence_score * 100).toFixed(1)}%`,
          'success'
        );
        resultsDiv.appendChild(sentimentCard);

        // Technical indicators
        if (analysis.indicators && analysis.indicators.length > 0) {
          const indicatorsCard = createResultCard(
            `Technical Indicators (${analysis.indicators.length})`,
            analysis.indicators.map(ind =>
              `<div class="indicator signal-${ind.signal}">
                                ${ind.name}: ${ind.signal.toUpperCase()} 
                                (Strength: ${(ind.strength * 100).toFixed(0)}%)
                            </div>`
            ).join(''),
            'success'
          );
          resultsDiv.appendChild(indicatorsCard);
        }

        // Chart patterns
        if (analysis.patterns && analysis.patterns.length > 0) {
          const patternsCard = createResultCard(
            `Chart Patterns (${analysis.patterns.length})`,
            analysis.patterns.map(pattern =>
              `<div class="pattern">
                                <strong>${pattern.name}</strong><br>
                                Signal: ${pattern.signal.toUpperCase()}<br>
                                Confidence: ${(pattern.confidence * 100).toFixed(0)}%
                                <div class="confidence-bar">
                                    <div class="confidence-fill" style="width: ${pattern.confidence * 100}%"></div>
                                </div>
                            </div>`
            ).join(''),
            'success'
          );
          resultsDiv.appendChild(patternsCard);
        }

        // Trading advice
        const adviceCard = createResultCard(
          'Trading Advice',
          `<strong>${analysis.trading_advice}</strong><br>
                     Risk Level: ${analysis.risk_level.toUpperCase()}`,
          'success'
        );
        resultsDiv.appendChild(adviceCard);

        // Support/Resistance levels
        if (analysis.support_levels && analysis.support_levels.length > 0) {
          const supportCard = createResultCard(
            'Support Levels',
            analysis.support_levels.map(level =>
              `${level.description} (Strength: ${(level.strength * 100).toFixed(0)}%)`
            ).join('<br>'),
            'success'
          );
          resultsDiv.appendChild(supportCard);
        }

        if (analysis.resistance_levels && analysis.resistance_levels.length > 0) {
          const resistanceCard = createResultCard(
            'Resistance Levels',
            analysis.resistance_levels.map(level =>
              `${level.description} (Strength: ${(level.strength * 100).toFixed(0)}%)`
            ).join('<br>'),
            'success'
          );
          resultsDiv.appendChild(resistanceCard);
        }

        // Processing time
        if (data.processing_time_ms) {
          const timeCard = createResultCard(
            'Performance',
            `Analysis completed in ${data.processing_time_ms.toFixed(2)}ms`,
            'success'
          );
          resultsDiv.appendChild(timeCard);
        }

      } else {
        const errorCard = createResultCard(
          'Error',
          data.message || 'Analysis failed',
          'error'
        );
        resultsDiv.appendChild(errorCard);
      }
    }

    // Create result card
    function createResultCard(title, content, type = 'success') {
      const card = document.createElement('div');
      card.className = `result-card ${type}`;
      card.innerHTML = `
                <h4>${title}</h4>
                <div>${content}</div>
            `;
      return card;
    }

    // Show loading
    function showLoading(message = 'Analyzing chart...') {
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = `<div class="loading">‚è≥ ${message}</div>`;
    }

    // Show error
    function showError(message) {
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = `<div class="result-card error">‚ùå Error: ${message}</div>`;
    }

    // File input change handler
    document.getElementById('fileInput').addEventListener('change', function (e) {
      const file = e.target.files[0];
      if (file) {
        analyzeChart(file);
      }
    });

    // Analyze chart
    async function analyzeChart(imageFile) {
      const apiUrl = getApiUrl();
      if (!apiUrl) {
        showError('Please enter your API URL first');
        return;
      }

      showLoading('Analyzing chart...');

      const formData = new FormData();
      formData.append('file', imageFile);

      try {
        const response = await fetch(`${apiUrl}/analyze-chart`, {
          method: 'POST',
          body: formData
        });

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }

        const result = await response.json();
        displayResults(result);

      } catch (error) {
        console.error('Error analyzing chart:', error);
        showError(`Failed to analyze chart: ${error.message}`);
      }
    }

    // Get demo analysis
    async function getDemoAnalysis() {
      const apiUrl = getApiUrl();
      if (!apiUrl) {
        showError('Please enter your API URL first');
        return;
      }

      showLoading('Getting demo analysis...');

      try {
        const response = await fetch(`${apiUrl}/demo`);

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }

        const result = await response.json();
        displayResults(result, true);

      } catch (error) {
        console.error('Error getting demo:', error);
        showError(`Failed to get demo: ${error.message}`);
      }
    }

    // Test API connection
    async function testConnection() {
      const apiUrl = getApiUrl();
      if (!apiUrl) return;

      try {
        const response = await fetch(`${apiUrl}/health`);
        if (response.ok) {
          console.log('‚úÖ API connection successful');
        } else {
          console.log('‚ùå API connection failed');
        }
      } catch (error) {
        console.log('‚ùå API connection failed:', error);
      }
    }

    // Test connection when page loads
    window.addEventListener('load', testConnection);
  </script>
</body>

</html>